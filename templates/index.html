<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barber&Shop ‚Äî Agenda Online</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: Arial, sans-serif; 
      background: #f5f5f5; 
      color: #333; 
      line-height: 1.6;
      font-size: 16px;
      transition: font-size 0.3s ease;
    }
    .container { max-width: 900px; margin: 2rem auto; padding: 1rem; background: #fff; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    header { 
      background: #111; 
      color: #fff; 
      padding: 1rem; 
      text-align: center; 
      position: relative;
    }
    header h1 { margin: 0; color: #d4af37; }
    nav a { color: #fff; margin: 0 0.5rem; text-decoration: none; }
    .card { padding: 1rem; border: 1px solid #ddd; border-radius: 6px; margin: 0.5rem 0; }
    form { margin-top: 2rem; }
    .form-group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.3rem; font-weight: bold; }
    .required { color: #e74c3c; }
    input, select, button { padding: 0.6rem; border: 1px solid #ccc; border-radius: 4px; width: 100%; font-size: 1rem; }
    button { background: #111; color: #fff; cursor: pointer; }
    button:disabled { background: #777; }
    .field-error { color: #e74c3c; font-size: 0.8rem; }
    .msg { padding: 0.8rem; border-radius: 4px; margin-top: 1rem; display: none; }
    .msg.sucesso { background: #d4edda; color: #155724; }
    .msg.erro { background: #f8d7da; color: #721c24; }
    .whatsapp-btn { background: #25D366; color: white; border: none; padding: 0.8rem; border-radius: 6px; cursor: pointer; margin: 0.5rem 0; width: 100%; }
    .copy-btn { background: #28a745; color: white; border: none; padding: 0.5rem; border-radius: 4px; cursor: pointer; margin: 0.5rem 0; width: 100%; }

    /* Controles de Acessibilidade */
    .accessibility-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
    }
    .zoom-btn {
      background: #d4af37;
      color: #111;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }
    .zoom-btn:hover {
      background: #f0c850;
    }
    .zoom-btn:focus {
      outline: 2px solid white;
      outline-offset: 2px;
    }
    .reset-btn {
      background: #555;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    @media (max-width: 768px) { 
      .container { margin: 1rem; padding: 1rem; } 
      .accessibility-controls {
        position: static;
        justify-content: center;
        margin-top: 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>GUELFI-Barber&Shop</h1>
    <nav>
      <a href="#servicos">Servi√ßos</a>
      <a href="#agendar">Agendar</a>
      <a href="#contato">Contato</a>
    </nav>
    <!-- Controles de Acessibilidade -->
    <div class="accessibility-controls" aria-label="Controles de acessibilidade">
      <button class="zoom-btn" id="zoom-out" aria-label="Diminuir tamanho da fonte">A-</button>
      <button class="reset-btn" id="reset-font" aria-label="Restaurar tamanho padr√£o da fonte">Padr√£o</button>
      <button class="zoom-btn" id="zoom-in" aria-label="Aumentar tamanho da fonte">A+</button>
    </div>
  </header>
  <main class="container">
    <section id="servicos">
      <h2>Nossos Servi√ßos</h2>
      <div class="card">
        <h3>Corte Social</h3>
        <p>R$ 45,00 ‚Äî Dura√ß√£o: 30min</p>
      </div>
      <div class="card">
        <h3>Corte Kids</h3>
        <p>R$ 35,00 ‚Äî Dura√ß√£o: 25min</p>
      </div>
      <div class="card">
        <h3>Cabelo e Barba</h3>
        <p>R$ 70,00 ‚Äî Dura√ß√£o: 50min</p>
      </div>
      <div class="card">
        <h3>Degrad√™ Giletado</h3>
        <p>R$ 60,00 ‚Äî Dura√ß√£o: 40min</p>
      </div>
    </section>

    <section id="agendar">
      <h2>Agendar Hor√°rio</h2>
      <form id="bookingForm">
        <div class="form-group">
          <label for="nome" class="required">Nome</label>
          <input type="text" id="nome" name="nome" required>
          <span class="field-error" id="nome-error"></span>
        </div>
        <div class="form-group">
          <label for="telefone" class="required">Telefone</label>
          <input type="tel" id="telefone" name="telefone" placeholder="(16) 99999-9999" required>
          <span class="field-error" id="telefone-error"></span>
        </div>
        <div class="form-group">
          <label for="servico" class="required">Servi√ßo</label>
          <select id="servico" name="servico" required>
            <option value="">Selecione...</option>
            <option value="corte">Corte Social</option>
            <option value="kids">Corte Kids</option>
            <option value="combo">Cabelo e Barba</option>
            <option value="degrade">Degrad√™ Giletado</option>
          </select>
          <span class="field-error" id="servico-error"></span>
        </div>
        <div class="form-group">
          <label for="data" class="required">Data</label>
          <input type="date" id="data" name="data" required>
          <span class="field-error" id="data-error"></span>
        </div>
        <div class="form-group">
          <label for="hora" class="required">Hor√°rio</label>
          <select id="hora" name="hora" required>
            <option value="">Selecione a data primeiro</option>
          </select>
          <span class="field-error" id="hora-error"></span>
        </div>
        <button type="submit" id="submit-btn">Confirmar Agendamento</button>
      </form>
      <div id="msg" class="msg"></div>
    </section>

    <section id="contato">
      <h2>Contato</h2>
      <p>üìç Avenida S√£o Jo√£o, 777 - Centro, Ibat√©/SP</p>
      <p>üìû (16) 99745-5195</p>
      <p>üìß fernandoguelfi.silva@gmail.com</p>
    </section>
  </main>

  <script>
    // Controles de Acessibilidade - Zoom de Fonte
    function inicializarControlesAcessibilidade() {
      const zoomInBtn = document.getElementById('zoom-in');
      const zoomOutBtn = document.getElementById('zoom-out');
      const resetBtn = document.getElementById('reset-font');

      const tamanhosFonte = [100, 110, 120, 130, 140, 150];
      let indiceFonteAtual = 0;

      const tamanhoSalvo = localStorage.getItem('tamanhoFonte');
      if (tamanhoSalvo) {
        indiceFonteAtual = parseInt(tamanhoSalvo);
        aplicarTamanhoFonte();
      }

      zoomInBtn.addEventListener('click', () => {
        if (indiceFonteAtual < tamanhosFonte.length - 1) {
          indiceFonteAtual++;
          aplicarTamanhoFonte();
        }
      });

      zoomOutBtn.addEventListener('click', () => {
        if (indiceFonteAtual > 0) {
          indiceFonteAtual--;
          aplicarTamanhoFonte();
        }
      });

      resetBtn.addEventListener('click', () => {
        indiceFonteAtual = 0;
        aplicarTamanhoFonte();
      });

      function aplicarTamanhoFonte() {
        const tamanho = tamanhosFonte[indiceFonteAtual];
        document.body.style.fontSize = `${tamanho}%`;
        localStorage.setItem('tamanhoFonte', indiceFonteAtual);
        zoomInBtn.disabled = indiceFonteAtual === tamanhosFonte.length - 1;
        zoomOutBtn.disabled = indiceFonteAtual === 0;
      }

      aplicarTamanhoFonte();
    }

    // Formata√ß√£o do telefone
    function formatarTelefone(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.length > 11) value = value.substring(0, 11);
      if (value.length > 10) {
        value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
      } else if (value.length > 6) {
        value = value.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
      }
      input.value = value;
    }

    // Configura√ß√£o da data
    function configurarDataMinima() {
      const dataInput = document.getElementById('data');
      const hoje = new Date().toISOString().split('T')[0];
      dataInput.min = hoje;
      dataInput.addEventListener('change', carregarHorarios);
    }

    // Carregar hor√°rios
    async function carregarHorarios() {
      const data = document.getElementById("data").value;
      if (!data) return;

      const select = document.getElementById("hora");
      select.disabled = true;
      select.innerHTML = '<option value="">Carregando...</option>';

      try {
        const res = await fetch("/horarios?data=" + data);
        const horarios = await res.json();

        select.innerHTML = "";
        if (horarios.length === 0) {
          select.innerHTML = '<option value="">Nenhum hor√°rio dispon√≠vel</option>';
        } else {
          horarios.forEach(h => {
            const opt = document.createElement("option");
            opt.value = h;
            opt.textContent = h;
            select.appendChild(opt);
          });
          select.disabled = false;
        }
      } catch (err) {
        select.innerHTML = '<option value="">Erro ao carregar</option>';
      }
    }

    // Copiar mensagem
    function copiarMensagem(texto) {
      navigator.clipboard.writeText(texto).then(() => {
        alert('Mensagem copiada! Cole no WhatsApp.');
      });
    }

    // Abrir WhatsApp
    function abrirWhatsApp(link) {
      window.open(link, '_blank');
    }

    // Valida√ß√£o do formul√°rio
    function validarFormulario() {
      let valido = true;
      const campos = ['nome', 'telefone', 'servico', 'data', 'hora'];

      campos.forEach(campo => {
        const element = document.getElementById(campo);
        const errorElement = document.getElementById(campo + '-error');

        if (!element.value) {
          errorElement.textContent = 'Campo obrigat√≥rio';
          valido = false;
        } else {
          errorElement.textContent = '';
        }
      });

      return valido;
    }

    // Event listeners
    document.addEventListener("DOMContentLoaded", () => {
      inicializarControlesAcessibilidade();

      const form = document.getElementById("bookingForm");
      const telefoneInput = document.getElementById("telefone");

      telefoneInput.addEventListener("input", function() {
        formatarTelefone(this);
      });

      configurarDataMinima();

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!validarFormulario()) {
          document.getElementById("msg").className = "msg erro";
          document.getElementById("msg").textContent = "Preencha todos os campos.";
          document.getElementById("msg").style.display = "block";
          return;
        }

        const submitBtn = document.getElementById("submit-btn");
        submitBtn.disabled = true;
        submitBtn.textContent = "Processando...";

        try {
          const formData = {
            nome: document.getElementById('nome').value,
            telefone: document.getElementById('telefone').value,
            servico: document.getElementById('servico').value,
            data: document.getElementById('data').value,
            horario: document.getElementById('hora').value
          };

          const res = await fetch("/agendar", {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
          });

          const result = await res.json();

          if (result.success) {
            const msgDiv = document.getElementById("msg");
            msgDiv.innerHTML = `
              <div style="text-align: center;">
                <h3>‚úÖ Agendamento Confirmado!</h3>
                <p><strong>C√≥digo:</strong> ${result.numero_confirmacao}</p>
                <button class="whatsapp-btn" onclick="abrirWhatsApp('${result.whatsapp_links.mobile_profissional}')">
                  üì± Abrir WhatsApp
                </button>
                <button class="copy-btn" onclick="copiarMensagem('${result.mensagem_direct}')">
                  üìã Copiar Mensagem
                </button>
                <p><small>Se o WhatsApp n√£o abrir, use a op√ß√£o "Copiar Mensagem"</small></p>
              </div>
            `;
            msgDiv.className = "msg sucesso";
            msgDiv.style.display = "block";

            // Tentar abrir WhatsApp automaticamente
            setTimeout(() => {
              abrirWhatsApp(result.whatsapp_links.mobile_profissional);
            }, 1000);

            form.reset();
            document.getElementById("hora").innerHTML = '<option value="">Selecione a data primeiro</option>';

          } else {
            document.getElementById("msg").className = "msg erro";
            document.getElementById("msg").textContent = result.message;
            document.getElementById("msg").style.display = "block";
          }
        } catch (error) {
          document.getElementById("msg").className = "msg erro";
          document.getElementById("msg").textContent = "Erro de conex√£o";
          document.getElementById("msg").style.display = "block";
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = "Confirmar Agendamento";
        }
      });
    });
  </script>
</body>
</html>